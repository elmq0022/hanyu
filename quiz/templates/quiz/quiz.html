{% extends "_base.html" %}

{% block content %}
    <!-- general form elements -->
    <div class="box box-primary">
    <div class="box-header with-border">
        <h3 class="box-title">Quiz</h3>
    </div>
    <!-- /.box-header -->
    <!-- form start -->
    <form role="form" id="quiz-form">
        {% csrf_token %}
        <div class="box-body">
        <div class="form-group">
            <label id="question"></label>
        </div>
            <div id="answers"> </div> 
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
            <button class="btn btn-primary">Submit</button>
        </div>
    </form>
    </div>
    <!-- /.box -->
{% endblock content %}

{% block javascript  %}
    {{ block.super }}
    <script>
        $(document).ready(setQuestion());

        function setQuestion(){
            var url = "/quiz/data/";
            setupAjax();
            $.getJSON(
                url,
            )
            .done(function(data){
                question(data);
            })
        }
        
        function question(data){

            var questionDiv = $("#question");
            var answerDiv = $("#answers");
            var answerList = []; 

            questionDiv.empty();
            questionDiv.append('<p>' + data.question + "</p>");
            $("#quiz-form").data("uid", data.uid)

            answerDiv.empty();
            var checkBoxHTML = function(ans){
                return '<div class="checkbox"><label><input type="radio" name="answer" value=' + 
                        ans.pk + '>' + ans.definition + '<\/label><\/div>';
            }
            for(var i=0; i < data.answers.length; i++){
                answerList.push(checkBoxHTML(data.answers[i]));
            }
            answerDiv.append(answerList.join(""));
        }

        $("#quiz-form").submit(function(e){
            e.preventDefault();
            var selectedAnswerID = $("input[name='answer']:checked").val();
            var quizID = $("#quiz-form").data("uid");
            setupAjax();
            $.ajax({
                type: "POST",
                url: "/quiz/data/",
                data: {uid: quizID, answer_pk: selectedAnswerID },
                success: function(){console.debug("Success!")},
                dataType: "json"
            }).done(function(data){
                alert(data["result"]);
                setQuestion();
            });
        }); 
    </script>
{% endblock javascript  %}